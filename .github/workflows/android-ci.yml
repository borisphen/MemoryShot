name: Android CI/CD (Debug Build)

on:
  push:
    branches: [ master ]  # –¢—Ä–∏–≥–≥–µ—Ä –Ω–∞ –ø—É—à–∏ –≤ master
  pull_request: # –ò –Ω–∞ PR –≤ master
    branches: [ master ]

jobs:
  build-and-publish:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout –∫–æ–¥–∞
      - uses: actions/checkout@v4

      # 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ JDK 17
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # 3. –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ gradlew
      - name: Make gradlew executable
        run: chmod +x gradlew

      # 4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Gradle (—É—Å–∫–æ—Ä—è–µ—Ç —Å–±–æ—Ä–∫—É)
      - name: Cache Gradle
        uses: actions/cache@v3
        with:
          path: ~/.gradle/caches
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*') }}

      # 5. –°–±–æ—Ä–∫–∞ debug-–≤–µ—Ä—Å–∏–∏
      - name: Build Debug APK
        run: ./gradlew assembleDebug

      # 6. –°–æ–∑–¥–∞–Ω–∏–µ GitHub Release –∏ –∑–∞–≥—Ä—É–∑–∫–∞ APK
      - name: Upload APK to GitHub Releases
        uses: softprops/action-gh-release@v1
        if: github.ref == 'refs/heads/master'  # –¢–æ–ª—å–∫–æ –¥–ª—è master
        with:
          files: app/build/outputs/apk/debug/app-debug.apk
          tag_name: debug-v${{ github.run_number }}  # –ê–≤—Ç–æ-—Ç–µ–≥ (debug-v1, debug-v2...)
          body: |
            Debug build for commit: ${{ github.sha }}
            –°–æ–±—Ä–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ GitHub Actions.
          draft: false
          prerelease: false

      # 7. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
      - name: Notify Telegram
        uses: appleboy/telegram-action@master
        if: github.ref == 'refs/heads/master'  # –¢–æ–ª—å–∫–æ –¥–ª—è master
        with:
          to: '@Borisphen'  # –í–∞—à Telegram username
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}  # –°–µ–∫—Ä–µ—Ç —Å —Ç–æ–∫–µ–Ω–æ–º –±–æ—Ç–∞
          message: |
            üöÄ –ù–æ–≤–∞—è debug-—Å–±–æ—Ä–∫–∞ Android-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!
            ‚Ä¢ –í–µ—Ä—Å–∏—è: debug-v${{ github.run_number }}
            ‚Ä¢ –°—Å—ã–ª–∫–∞: https://github.com/${{ github.repository }}/releases/tag/debug-v${{ github.run_number }}
            ‚Ä¢ –ö–æ–º–º–∏—Ç: ${{ github.sha }}